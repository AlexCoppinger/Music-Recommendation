<h1>Rate Track</h1>
<div class="container text-center mt-5">
    <h2>{{ track.name }}</h2>
    <p><strong>Artist:</strong> {{ track.artist }}</p>
    <p><strong>Album:</strong> {{ track.album }}</p>

    <button class="btn btn-success play-btn"
            data-track-id="{{ track.id }}">
        ▶️ Play on Spotify
    </button>
</div>

<script>
document.addEventListener('DOMContentLoaded', function () {
    const playButton = document.querySelector('.play-btn');

    playButton.addEventListener('click', function () {
        const trackId = this.dataset.trackId;

        fetch("{% url 'vibelink:play_track' %}", {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': '{{ csrf_token }}',
            },
            body: JSON.stringify({ track_id: trackId })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert('Playback started on your Spotify device.');
            } else {
                alert('Playback failed: ' + data.error);
            }
        })
        .catch(error => {
            console.error("Fetch error:", error);
            alert("Request failed: " + error.message);
        });
    });
});
</script>
